# Black Atom Niri Adapter

## Overview

This is a Black Atom adapter for the Niri Wayland compositor. It generates partial KDL configuration files that can be included in the main niri config using niri's `include` directive (v25.11+).

## Commands

- **Generate themes**: `black-atom-core generate` (run from this directory)
- **Format**: `deno fmt` (if editing templates)

## Project Structure

```
niri/
├── black-atom-adapter.json     # Adapter configuration (theme list per collection)
├── CLAUDE.md
├── README.md
├── LICENSE
└── themes/
    ├── default/
    │   ├── collection.template.kdl    # Template file
    │   └── black-atom-default-*.kdl   # Generated themes
    ├── jpn/
    ├── stations/
    ├── terra/
    └── mnml/
```

## Template Format

Templates use Eta syntax (`<%= %>`) and generate partial KDL configs:

```kdl
// Black Atom Theme: <%= theme.meta.label %>
// Generated by black-atom-core - DO NOT EDIT

overview {
    backdrop-color "<%= theme.ui.bg.panel %>"

    workspace-shadow {
        color "<%= theme.ui.bg.default %>50"
    }
}

layout {
    focus-ring {
        active-color "<%= theme.ui.fg.accent %>"
        inactive-color "<%= theme.ui.fg.subtle %>"
    }

    border {
        active-color "<%= theme.ui.fg.accent %>"
        inactive-color "<%= theme.ui.fg.subtle %>"
        urgent-color "<%= theme.palette.red %>"
    }

    shadow {
        on
        color "<%= theme.ui.bg.default %>70"
    }
}
```

## Theme Properties Used

| Property | Usage | Description |
|----------|-------|-------------|
| `theme.meta.label` | Comment header | Human-readable theme name |
| `theme.ui.bg.panel` | `backdrop-color` | Overview backdrop |
| `theme.ui.bg.default` | Shadow colors | Base for shadow with alpha |
| `theme.ui.fg.accent` | `active-color` | Focus ring & border active |
| `theme.ui.fg.subtle` | `inactive-color` | Focus ring & border inactive |
| `theme.palette.red` | `urgent-color` | Border urgent state |

## Niri Integration

### How Include Works

Niri's `include` directive merges settings from external files:

```kdl
// In ~/.config/niri/config.kdl
include "theme.kdl"
```

- Included files are watched for changes (live-reload)
- Settings merge with main config
- Include must be at top level (not inside sections)
- Properties from includes can be overridden by later definitions

### Recommended Setup

1. Generate themes: `black-atom-core generate`
2. Create symlink: `ln -sf /path/to/niri/themes/jpn/black-atom-jpn-koyo-yoru.kdl ~/.config/niri/theme.kdl`
3. Add to config: `include "theme.kdl"`
4. Switch themes by updating the symlink

### What the Theme Controls

- **Overview**: backdrop-color, workspace-shadow color
- **Focus Ring**: active-color, inactive-color
- **Border**: active-color, inactive-color, urgent-color
- **Shadow**: enabled state, color

### What Stays in Main Config

These settings should remain in your main `config.kdl`:
- `overview { zoom }`, `workspace-shadow { softness, spread, offset }`
- `focus-ring { width }`, `border { width, off }`
- `shadow { softness, spread, offset, draw-behind-window }`

## Development

### Editing Templates

All 5 collection templates are identical - edit all of them when making changes:
- `themes/default/collection.template.kdl`
- `themes/jpn/collection.template.kdl`
- `themes/stations/collection.template.kdl`
- `themes/terra/collection.template.kdl`
- `themes/mnml/collection.template.kdl`

### After Template Changes

1. Regenerate: `black-atom-core generate`
2. Test: niri will live-reload if theme.kdl symlink is set up
3. Commit: `git add -A && git commit -m "description" && git push`
